var Ne=Object.create;var T=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var He=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var J=n=>T(n,"__esModule",{value:!0});var m=(n,f)=>()=>(f||n((f={exports:{}}).exports,f),f.exports),Ve=(n,f)=>{for(var c in f)T(n,c,{get:f[c],enumerable:!0})},z=(n,f,c,e)=>{if(f&&typeof f=="object"||typeof f=="function")for(let t of Re(f))!Ke.call(n,t)&&(c||t!=="default")&&T(n,t,{get:()=>f[t],enumerable:!(e=Ge(f,t))||e.enumerable});return n},I=(n,f)=>z(J(T(n!=null?Ne(He(n)):{},"default",!f&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),Je=(n=>(f,c)=>n&&n.get(f)||(c=z(J({}),f,1),n&&n.set(f,c),c))(typeof WeakMap!="undefined"?new WeakMap:0);var U=m(h=>{"use strict";var E=h&&h.__assign||function(){return E=Object.assign||function(n){for(var f,c=1,e=arguments.length;c<e;c++){f=arguments[c];for(var t in f)Object.prototype.hasOwnProperty.call(f,t)&&(n[t]=f[t])}return n},E.apply(this,arguments)},A=h&&h.__awaiter||function(n,f,c,e){function t(r){return r instanceof c?r:new c(function(a){a(r)})}return new(c||(c=Promise))(function(r,a){function i(s){try{u(e.next(s))}catch(_){a(_)}}function o(s){try{u(e.throw(s))}catch(_){a(_)}}function u(s){s.done?r(s.value):t(s.value).then(i,o)}u((e=e.apply(n,f||[])).next())})},D=h&&h.__generator||function(n,f){var c={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},e,t,r,a;return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(u){return function(s){return o([u,s])}}function o(u){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(c=0)),c;)try{if(e=1,t&&(r=u[0]&2?t.return:u[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,u[1])).done)return r;switch(t=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return c.label++,{value:u[1],done:!1};case 5:c.label++,t=u[1],u=[0];continue;case 7:u=c.ops.pop(),c.trys.pop();continue;default:if(r=c.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){c=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){c.label=u[1];break}if(u[0]===6&&c.label<r[1]){c.label=r[1],r=u;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(u);break}r[2]&&c.ops.pop(),c.trys.pop();continue}u=f.call(n,c)}catch(s){u=[6,s],t=0}finally{e=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};h.__esModule=!0;h.getMiddlewareHandler=h.MiddlewareContext=void 0;var L=function(){function n(){var f=this.constructor;this.context={},Object.setPrototypeOf(this,f.prototype)}return n.prototype.set=function(f,c){this.context[f]=c},n.prototype.get=function(f){return this.context[f]},n}();h.MiddlewareContext=L;var ze=function(n,f,c,e){return A(void 0,void 0,void 0,function(){var t;return D(this,function(r){switch(r.label){case 0:t=n(f,c,e),r.label=1;case 1:return typeof(t==null?void 0:t.then)!="function"?[3,3]:[4,t];case 2:return t=r.sent(),[3,1];case 3:return[2,t]}})})},Le=function(n,f){return function(c,e,t){return A(void 0,void 0,void 0,function(){var r,a,i;return D(this,function(o){switch(o.label){case 0:return r=E(E({},c),{somodMiddlewareContext:new L}),a=f.length,i=function(){return A(void 0,void 0,void 0,function(){var u,s,_;return D(this,function(l){switch(l.label){case 0:return a>0?(u=f[--a],[4,u(i,r,e)]):[3,2];case 1:return s=l.sent(),[2,s];case 2:return[4,ze(n,r,e,t)];case 3:return _=l.sent(),[2,_]}})})},[4,i()];case 1:return[2,o.sent()]}})})}};h.getMiddlewareHandler=Le});var B=m(O=>{"use strict";var Ue=O&&O.__createBinding||(Object.create?function(n,f,c,e){e===void 0&&(e=c);var t=Object.getOwnPropertyDescriptor(f,c);(!t||("get"in t?!f.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(n,e,t)}:function(n,f,c,e){e===void 0&&(e=c),n[e]=f[c]});O.__esModule=!0;O.getMiddlewareHandler=void 0;var Be=U();Ue(O,Be,"getMiddlewareHandler")});var we=m((dt,C)=>{var W,Y,Q,X,Z,$,k,ee,te,re,ne,ae,ie,M,q,oe,ue,ce,j,fe,le,se,de,_e,ve,ye,he,pe,x;(function(n){var f=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(e){n(c(f,c(e)))}):typeof C=="object"&&typeof C.exports=="object"?n(c(f,c(C.exports))):n(c(f));function c(e,t){return e!==f&&(typeof Object.create=="function"?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,a){return e[r]=t?t(r,a):a}}})(function(n){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};W=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");f(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},Y=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Q=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r},X=function(e,t,r,a){var i=arguments.length,o=i<3?t:a===null?a=Object.getOwnPropertyDescriptor(t,r):a,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,a);else for(var s=e.length-1;s>=0;s--)(u=e[s])&&(o=(i<3?u(o):i>3?u(t,r,o):u(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o},Z=function(e,t){return function(r,a){t(r,a,e)}},$=function(e,t,r,a,i,o){function u(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var s=a.kind,_=s==="getter"?"get":s==="setter"?"set":"value",l=!t&&e?a.static?e:e.prototype:null,d=t||(l?Object.getOwnPropertyDescriptor(l,a.name):{}),y,v=!1,p=r.length-1;p>=0;p--){var w={};for(var b in a)w[b]=b==="access"?{}:a[b];for(var b in a.access)w.access[b]=a.access[b];w.addInitializer=function(S){if(v)throw new TypeError("Cannot add initializers after decoration has completed");o.push(u(S||null))};var g=(0,r[p])(s==="accessor"?{get:d.get,set:d.set}:d[_],w);if(s==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(y=u(g.get))&&(d.get=y),(y=u(g.set))&&(d.set=y),(y=u(g.init))&&i.push(y)}else(y=u(g))&&(s==="field"?i.push(y):d[_]=y)}l&&Object.defineProperty(l,a.name,d),v=!0},k=function(e,t,r){for(var a=arguments.length>2,i=0;i<t.length;i++)r=a?t[i].call(e,r):t[i].call(e);return a?r:void 0},ee=function(e){return typeof e=="symbol"?e:"".concat(e)},te=function(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})},re=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)},ne=function(e,t,r,a){function i(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function s(d){try{l(a.next(d))}catch(y){u(y)}}function _(d){try{l(a.throw(d))}catch(y){u(y)}}function l(d){d.done?o(d.value):i(d.value).then(s,_)}l((a=a.apply(e,t||[])).next())})},ae=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},a,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(l){return function(d){return _([l,d])}}function _(l){if(a)throw new TypeError("Generator is already executing.");for(;u&&(u=0,l[0]&&(r=0)),r;)try{if(a=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(d){l=[6,d],i=0}finally{a=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ie=function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&x(t,e,r)},x=Object.create?function(e,t,r,a){a===void 0&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){a===void 0&&(a=r),e[a]=t[r]},M=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},q=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),i,o=[],u;try{for(;(t===void 0||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(s){u={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(u)throw u.error}}return o},oe=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(q(arguments[t]));return e},ue=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var a=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],u=0,s=o.length;u<s;u++,i++)a[i]=o[u];return a},ce=function(e,t,r){if(r||arguments.length===2)for(var a=0,i=t.length,o;a<i;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},j=function(e){return this instanceof j?(this.v=e,this):new j(e)},fe=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=r.apply(e,t||[]),i,o=[];return i={},u("next"),u("throw"),u("return"),i[Symbol.asyncIterator]=function(){return this},i;function u(v){a[v]&&(i[v]=function(p){return new Promise(function(w,b){o.push([v,p,w,b])>1||s(v,p)})})}function s(v,p){try{_(a[v](p))}catch(w){y(o[0][3],w)}}function _(v){v.value instanceof j?Promise.resolve(v.value.v).then(l,d):y(o[0][2],v)}function l(v){s("next",v)}function d(v){s("throw",v)}function y(v,p){v(p),o.shift(),o.length&&s(o[0][0],o[0][1])}},le=function(e){var t,r;return t={},a("next"),a("throw",function(i){throw i}),a("return"),t[Symbol.iterator]=function(){return this},t;function a(i,o){t[i]=e[i]?function(u){return(r=!r)?{value:j(e[i](u)),done:!1}:o?o(u):u}:o}},se=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof M=="function"?M(e):e[Symbol.iterator](),r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r);function a(o){r[o]=e[o]&&function(u){return new Promise(function(s,_){u=e[o](u),i(s,_,u.done,u.value)})}}function i(o,u,s,_){Promise.resolve(_).then(function(l){o({value:l,done:s})},u)}},de=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var c=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};_e=function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&x(t,e,r);return c(t,e),t},ve=function(e){return e&&e.__esModule?e:{default:e}},ye=function(e,t,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(e):a?a.value:t.get(e)},he=function(e,t,r,a,i){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r},pe=function(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)},n("__extends",W),n("__assign",Y),n("__rest",Q),n("__decorate",X),n("__param",Z),n("__esDecorate",$),n("__runInitializers",k),n("__propKey",ee),n("__setFunctionName",te),n("__metadata",re),n("__awaiter",ne),n("__generator",ae),n("__exportStar",ie),n("__createBinding",x),n("__values",M),n("__read",q),n("__spread",oe),n("__spreadArrays",ue),n("__spreadArray",ce),n("__await",j),n("__asyncGenerator",fe),n("__asyncDelegator",le),n("__asyncValues",se),n("__makeTemplateObject",de),n("__importStar",_e),n("__importDefault",ve),n("__classPrivateFieldGet",ye),n("__classPrivateFieldSet",he),n("__classPrivateFieldIn",pe)})});var F=m((Vt,Oe)=>{var We=require("crypto");Oe.exports=function(){return We.randomBytes(16)}});var N=m((Jt,Se)=>{var je=[];for(P=0;P<256;++P)je[P]=(P+256).toString(16).substr(1);var P;function Ye(n,f){var c=f||0,e=je;return[e[n[c++]],e[n[c++]],e[n[c++]],e[n[c++]],"-",e[n[c++]],e[n[c++]],"-",e[n[c++]],e[n[c++]],"-",e[n[c++]],e[n[c++]],"-",e[n[c++]],e[n[c++]],e[n[c++]],e[n[c++]],e[n[c++]],e[n[c++]]].join("")}Se.exports=Ye});var Ee=m((zt,Te)=>{var Qe=F(),Xe=N(),Pe,G,R=0,H=0;function Ze(n,f,c){var e=f&&c||0,t=f||[];n=n||{};var r=n.node||Pe,a=n.clockseq!==void 0?n.clockseq:G;if(r==null||a==null){var i=Qe();r==null&&(r=Pe=[i[0]|1,i[1],i[2],i[3],i[4],i[5]]),a==null&&(a=G=(i[6]<<8|i[7])&16383)}var o=n.msecs!==void 0?n.msecs:new Date().getTime(),u=n.nsecs!==void 0?n.nsecs:H+1,s=o-R+(u-H)/1e4;if(s<0&&n.clockseq===void 0&&(a=a+1&16383),(s<0||o>R)&&n.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");R=o,H=u,G=a,o+=122192928e5;var _=((o&268435455)*1e4+u)%4294967296;t[e++]=_>>>24&255,t[e++]=_>>>16&255,t[e++]=_>>>8&255,t[e++]=_&255;var l=o/4294967296*1e4&268435455;t[e++]=l>>>8&255,t[e++]=l&255,t[e++]=l>>>24&15|16,t[e++]=l>>>16&255,t[e++]=a>>>8|128,t[e++]=a&255;for(var d=0;d<6;++d)t[e+d]=r[d];return f||Xe(t)}Te.exports=Ze});var xe=m((Lt,Me)=>{var $e=F(),ke=N();function et(n,f,c){var e=f&&c||0;typeof n=="string"&&(f=n==="binary"?new Array(16):null,n=null),n=n||{};var t=n.random||(n.rng||$e)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,f)for(var r=0;r<16;++r)f[e+r]=t[r];return f||ke(t)}Me.exports=et});var Ae=m((Ut,Ie)=>{var tt=Ee(),Ce=xe(),K=Ce;K.v1=tt;K.v4=Ce;Ie.exports=K});var ct={};Ve(ct,{default:()=>ut});var Fe=I(B());var be=I(we(),1),{__extends:_t,__assign:vt,__rest:yt,__decorate:ht,__param:pt,__esDecorate:wt,__runInitializers:bt,__propKey:mt,__setFunctionName:gt,__metadata:Ot,__awaiter:me,__generator:ge,__exportStar:jt,__createBinding:St,__values:Pt,__read:Tt,__spread:Et,__spreadArrays:Mt,__spreadArray:xt,__await:Ct,__asyncGenerator:It,__asyncDelegator:At,__asyncValues:Dt,__makeTemplateObject:qt,__importStar:Ft,__importDefault:Nt,__classPrivateFieldGet:Gt,__classPrivateFieldSet:Rt,__classPrivateFieldIn:Ht}=be.default;var V=require("aws-sdk"),De=I(Ae()),rt=new V.DynamoDB({apiVersion:"2012-08-10",region:process.env.AWS_REGION}),nt=process.env.TABLE_NAME,at=process.env.API_KEY,it=function(n){return me(void 0,void 0,void 0,function(){var f,c,e,t;return ge(this,function(r){switch(r.label){case 0:return n.headers.authorization!==at?[2,{statusCode:401}]:(f=JSON.parse(n.body||"{}"),(f==null?void 0:f.message)===void 0||(f==null?void 0:f.audience)===void 0?[2,{statusCode:400,body:JSON.stringify({error:"must have 'message' and 'audience' properties in the body"}),headers:{"Content-Type":"application/json"}}]:((e=f.audience)===null||e===void 0?void 0:e.userId)===void 0&&((t=f.audience)===null||t===void 0?void 0:t.groupId)===void 0?[2,{statusCode:400,body:JSON.stringify({error:"audience property must have 'userId' or 'groupId'"}),headers:{"Content-Type":"application/json"}}]:(c=(0,De.v1)(),[4,rt.putItem({TableName:nt,Item:V.DynamoDB.Converter.marshall({messageId:c,message:f.message,audience:f.audience})}).promise()]));case 1:return r.sent(),[2,{statusCode:200,body:JSON.stringify({messageId:c}),headers:{"Content-Type":"application/json"}}]}})})},qe=it;var ot=(0,Fe.getMiddlewareHandler)(qe,[]),ut=ot;module.exports=Je(ct);0&&(module.exports={});
