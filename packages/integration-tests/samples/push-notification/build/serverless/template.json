{"Resources":{"MessageTypeTable":{"Type":"AWS::DynamoDB::Table","Properties":{"AttributeDefinitions":[{"AttributeName":"type","AttributeType":"S"},{"AttributeName":"messageId","AttributeType":"S"}],"KeySchema":[{"AttributeName":"type","KeyType":"HASH"}],"GlobalSecondaryIndexes":[{"IndexName":"byMessageId","KeySchema":[{"AttributeName":"messageId","KeyType":"HASH"}],"Projection":{"ProjectionType":"ALL"}}],"BillingMode":"PAY_PER_REQUEST","SSESpecification":{"SSEEnabled":true}}},"MessageSegrgationFunction":{"Type":"AWS::Serverless::Function","Properties":{"CodeUri":{"SOMOD::Function":{"type":"DynamoDB","name":"segregatemessage"}},"MemorySize":256,"Environment":{"Variables":{"MESSAGE_TYPE_TABLE_NAME":{"SOMOD::Ref":{"resource":"MessageTypeTable"}}}},"Events":{"StreamFromMessagesTable":{"Type":"DynamoDB","Properties":{"Stream":{"SOMOD::Ref":{"module":"push-notification-service","resource":"MessagesTable","attribute":"StreamArn"}},"BatchSize":10,"StartingPosition":"LATEST","MaximumRetryAttempts":3,"ParallelizationFactor":10}}},"Policies":[{"DynamoDBCrudPolicy":{"TableName":{"SOMOD::Ref":{"resource":"MessageTypeTable"}}}}],"Timeout":300}},"AuthorizerLambda":{"Type":"AWS::Serverless::Function","SOMOD::Output":{"default":true,"attributes":["Arn"]},"Properties":{"CodeUri":{"SOMOD::Function":{"type":"HttpApiAuthorizer","name":"authorizer"}},"Environment":{"Variables":{"secret":{"SOMOD::Parameter":"authorizer.jwt.secret"}}}}},"AuthorizerHttpApi":{"Type":"AWS::Serverless::HttpApi","SOMOD::Extend":{"module":"push-notification-service","resource":"ManagementApi"},"Properties":{"Auth":{"Authorizers":{"LambdaAuthorizer":{"AuthorizerPayloadFormatVersion":"2.0","EnableFunctionDefaultPermissions":true,"EnableSimpleResponses":true,"FunctionArn":{"SOMOD::Ref":{"module":"push-notification","resource":"AuthorizerLambda","attribute":"Arn"}},"Identity":{"Headers":["Authorization"]}}},"DefaultAuthorizer":"LambdaAuthorizer"}}}}}